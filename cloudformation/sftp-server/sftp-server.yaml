AWSTemplateFormatVersion: '2010-09-09'
Resources:
  # Define the S3 bucket where files will be stored

  # Define the Transfer Family SFTP server
  MySFTPServer:
    Type: 'AWS::Transfer::Server'
    Properties:
      EndpointType: 'PUBLIC' # Can be 'PUBLIC' or 'VPC'
      Protocols:
        - 'SFTP'
      IdentityProviderType: 'SERVICE_MANAGED' # Using service-managed users
      LoggingRole: !GetAtt LoggingRole.Arn

  # Define the IAM Role for logging
  LoggingRole:
    Type: 'AWS::IAM::Role'
    Properties:
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
          - Effect: 'Allow'
            Principal:
              Service: 'transfer.amazonaws.com'
            Action: 'sts:AssumeRole'
      Path: '/'
      RoleName: 'TransferLoggingRole'
      Policies:
        - PolicyName: 'TransferLoggingPolicy'
          PolicyDocument:
            Version: '2012-10-17'
            Statement:
              - Effect: 'Allow'
                Action:
                  - 'logs:CreateLogStream'
                  - 'logs:PutLogEvents'
                Resource: '*'

Outputs:
  SFTPServerEndpoint:
    Description: 'The endpoint of the SFTP server'
    Value: !Sub 's-${MySFTPServer}.server.transfer.us-east-1.amazonaws.com'
